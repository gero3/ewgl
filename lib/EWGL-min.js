var EWGL={};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),EWGL.noop=function(){},EWGL.DEBUG=!0,function(a){var b=Array.prototype.indexOf,c=Array.prototype.splice,d=Array.prototype.push,e=Array.prototype.pop,f,g=function(a){var b,c;if(Array.isArray(a)||g.isList(a)){c=a.length,this.length=c;for(b=0;b<c;b++)this[b]=a[b]}else a===null||a===undefined?this.length=0:(this.length=1,this[0]=a);this.itemAdded=function(a){},this.itemRemoved=function(a){}};g.prototype.add=function(a){return this[this.length]=a,this.length++,this.itemAdded(a),this},g.prototype.addRange=function(a){var b,c=a.length;for(b=0;b<c;b++)this[this.length]=a[b],this.length++,this.itemAdded(a[b]);return this},g.prototype.contains=function(a){var b,c=this.length;for(b=0;b<c;b++)if(this[b]===a)return!0;return!1},g.prototype.clone=function(){return new g(this)},g.prototype.clear=function(){while(this.length)this.itemRemoved(e.call(this));return this},g.prototype.exists=function(a){var b,c=this.length;for(b=0;b<c;b++)if(a(this[b],b))return!0;return!1},g.prototype.findFirst=g.prototype.find=function(a){var b,c=this.length;for(b=0;b<c;b++)if(a(this[b],b))return this[b];return undefined},g.prototype.findAll=function(a){var b,c=this.length,d=new g;for(b=0;b<c;b++)a(this[b],b)&&d.add(this[b]);return d},g.prototype.findLast=function(a){var b,c=this.length;for(b=c;b>0;b--)if(a(this[b],b))return this[b];return undefined},g.prototype.forEach=function(a){var b,c=this.length;for(b=0;b<c;b++)a(this[b],b);return undefined},g.prototype.remove=function(a){var d=b.call(this,a);d>-1&&(c.call(this,d,1),this.itemRemoved(a))},g.prototype.removeAll=function(a){var b,c,d=this.length;if(!a)this.clear();else for(b=0;b<d;b++)a(this[b],b)&&(this.removeAt(b),d--)},g.prototype.removeAt=function(a){a>-1&&this.itemRemoved(c.call(this,a,1)[0])},g.isList=function(a){return a instanceof g},a.list=g}(EWGL);var arraychosen=function(a){var b=[];while(a--)b.push(0);return b};typeof Float32Array!="undefined"?glMatrixArrayType=Float32Array:typeof WebGLFloatArray!="undefined"?glMatrixArrayType=WebGLFloatArray:glMatrixArrayType=arraychosen;var vec3={};vec3.create=function(a){var b=new glMatrixArrayType(3);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),b},vec3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},vec3.add=function(a,b,c){return!c||a==c?(a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a):(c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c)},vec3.subtract=function(a,b,c){return!c||a==c?(a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a):(c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c)},vec3.negate=function(a,b){return b||(b=a),b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b},vec3.scale=function(a,b,c){return!c||a==c?(a[0]*=b,a[1]*=b,a[2]*=b,a):(c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c)},vec3.scaleVec3=function(a,b,c){return c||(c=a),c[0]=a[0]*b[0],c[1]=a[1]*b[1],c[2]=a[2]*b[2],c},vec3.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);return f?f===1?(b[0]=c,b[1]=d,b[2]=e,b):(f=1/f,b[0]=c*f,b[1]=d*f,b[2]=e*f,b):(b[0]=0,b[1]=0,b[2]=0,b)},vec3.cross=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=b[0],h=b[1],i=b[2];return c[0]=e*i-f*h,c[1]=f*g-d*i,c[2]=d*h-e*g,c},vec3.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},vec3.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],f=a[2]-b[2],g=Math.sqrt(d*d+e*e+f*f);return g?(g=1/g,c[0]=d*g,c[1]=e*g,c[2]=f*g,c):(c[0]=0,c[1]=0,c[2]=0,c)},vec3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var mat3={};mat3.create=function(a){var b=new glMatrixArrayType(9);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9]),b},mat3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},mat3.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.toMat4=function(a,b){return b||(b=mat4.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=0,b[4]=a[3],b[5]=a[4],b[6]=a[5],b[7]=0,b[8]=a[6],b[9]=a[7],b[10]=a[8],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},mat3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};var mat4={};mat4.create=function(a){var b=new glMatrixArrayType(16);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]),b},mat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];return a[1]=a[4],a[2]=a[8],a[3]=a[12],a[4]=c,a[6]=a[9],a[7]=a[13],a[8]=d,a[9]=f,a[11]=a[14],a[12]=e,a[13]=g,a[14]=h,a}return b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15],b},mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15];return n*k*h*e-j*o*h*e-n*g*l*e+f*o*l*e+j*g*p*e-f*k*p*e-n*k*d*i+j*o*d*i+n*c*l*i-b*o*l*i-j*c*p*i+b*k*p*i+n*g*d*m-f*o*d*m-n*c*h*m+b*o*h*m+f*c*p*m-b*g*p*m-j*g*d*q+f*k*d*q+j*c*h*q-b*k*h*q-f*c*l*q+b*g*l*q},mat4.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=1/(s*D-t*C+u*B+v*A-w*z+x*y);return b[0]=(h*D-i*C+j*B)*E,b[1]=(-d*D+e*C-f*B)*E,b[2]=(p*x-q*w+r*v)*E,b[3]=(-l*x+m*w-n*v)*E,b[4]=(-g*D+i*A-j*z)*E,b[5]=(c*D-e*A+f*z)*E,b[6]=(-o*x+q*u-r*t)*E,b[7]=(k*x-m*u+n*t)*E,b[8]=(g*C-h*A+j*y)*E,b[9]=(-c*C+d*A-f*y)*E,b[10]=(o*w-p*u+r*s)*E,b[11]=(-k*w+l*u-n*s)*E,b[12]=(-g*B+h*z-i*y)*E,b[13]=(c*B-d*z+e*y)*E,b[14]=(-o*v+p*t-q*s)*E,b[15]=(k*v-l*t+m*s)*E,b},mat3.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[5];return a[1]=a[3],a[2]=a[6],a[3]=c,a[5]=a[7],a[6]=d,a[7]=e,a}return b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8],b},mat4.toMat3=function(a,b){return b||(b=mat3.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10],b},mat4.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;if(!o)return null;var p=1/o;return b||(b=mat3.create()),b[0]=l*p,b[1]=(-k*d+e*j)*p,b[2]=(h*d-e*g)*p,b[3]=m*p,b[4]=(k*c-e*i)*p,b[5]=(-h*c+e*f)*p,b[6]=n*p,b[7]=(-j*c+d*i)*p,b[8]=(g*c-d*f)*p,b},mat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];return c[0]=t*d+u*h+v*l+w*p,c[1]=t*e+u*i+v*m+w*q,c[2]=t*f+u*j+v*n+w*r,c[3]=t*g+u*k+v*o+w*s,c[4]=x*d+y*h+z*l+A*p,c[5]=x*e+y*i+z*m+A*q,c[6]=x*f+y*j+z*n+A*r,c[7]=x*g+y*k+z*o+A*s,c[8]=B*d+C*h+D*l+E*p,c[9]=B*e+C*i+D*m+E*q,c[10]=B*f+C*j+D*n+E*r,c[11]=B*g+C*k+D*o+E*s,c[12]=F*d+G*h+H*l+I*p,c[13]=F*e+G*i+H*m+I*q,c[14]=F*f+G*j+H*n+I*r,c[15]=F*g+G*k+H*o+I*s,c},mat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];return c[0]=a[0]*d+a[4]*e+a[8]*f+a[12],c[1]=a[1]*d+a[5]*e+a[9]*f+a[13],c[2]=a[2]*d+a[6]*e+a[10]*f+a[14],c},mat4.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],g=b[3];return c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*g,c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*g,c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*g,c[4]=a[4]*d+a[7]*e+a[11]*f+a[15]*g,c},mat4.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2];if(!c||a==c)return a[12]=a[0]*d+a[4]*e+a[8]*f+a[12],a[13]=a[1]*d+a[5]*e+a[9]*f+a[13],a[14]=a[2]*d+a[6]*e+a[10]*f+a[14],a[15]=a[3]*d+a[7]*e+a[11]*f+a[15],a;var g=a[0],h=a[1],i=a[2],j=a[3],k=a[4],l=a[5],m=a[6],n=a[7],o=a[8],p=a[9],q=a[10],r=a[11];return c[0]=g,c[1]=h,c[2]=i,c[3]=j,c[4]=k,c[5]=l,c[6]=m,c[7]=n,c[8]=o,c[9]=p,c[10]=q,c[11]=r,c[12]=g*d+k*e+o*f+a[12],c[13]=h*d+l*e+p*f+a[13],c[14]=i*d+m*e+q*f+a[14],c[15]=j*d+n*e+r*f+a[15],c},mat4.setTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2];if(!c||a==c)return a[12]=d,a[13]=e,a[14]=f,a;var g=a[0],h=a[1],i=a[2],j=a[3],k=a[4],l=a[5],m=a[6],n=a[7],o=a[8],p=a[9],q=a[10],r=a[11];return c[0]=g,c[1]=h,c[2]=i,c[3]=j,c[4]=k,c[5]=l,c[6]=m,c[7]=n,c[8]=o,c[9]=p,c[10]=q,c[11]=r,c[12]=d,c[13]=e,c[14]=f,c[15]=a[15],c},mat4.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2];return!c||a==c?(a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=f,a[9]*=f,a[10]*=f,a[11]*=f,a):(c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d,c[4]=a[4]*e,c[5]=a[5]*e,c[6]=a[6]*e,c[7]=a[7]*e,c[8]=a[8]*f,c[9]=a[9]*f,c[10]=a[10]*f,c[11]=a[11]*f,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c)},mat4.rotate=function(a,b,c,d){var e=c[0],f=c[1],g=c[2],h=Math.sqrt(e*e+f*f+g*g);if(!h)return null;h!=1&&(h=1/h,e*=h,f*=h,g*=h);var i=Math.sin(b),j=Math.cos(b),k=1-j,l=a[0],m=a[1],n=a[2],o=a[3],p=a[4],q=a[5],r=a[6],s=a[7],t=a[8],u=a[9],v=a[10],w=a[11],x=e*e*k+j,y=f*e*k+g*i,z=g*e*k-f*i,A=e*f*k-g*i,B=f*f*k+j,C=g*f*k+e*i,D=e*g*k+f*i,E=f*g*k-e*i,F=g*g*k+j;return d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[0]=l*x+p*y+t*z,d[1]=m*x+q*y+u*z,d[2]=n*x+r*y+v*z,d[3]=o*x+s*y+w*z,d[4]=l*A+p*B+t*C,d[5]=m*A+q*B+u*C,d[6]=n*A+r*B+v*C,d[7]=o*A+s*B+w*C,d[8]=l*D+p*E+t*F,d[9]=m*D+q*E+u*F,d[10]=n*D+r*E+v*F,d[11]=o*D+s*E+w*F,d},mat4.rotateX=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11];return c?a!=c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[4]=f*e+j*d,c[5]=g*e+k*d,c[6]=h*e+l*d,c[7]=i*e+m*d,c[8]=f*-d+j*e,c[9]=g*-d+k*e,c[10]=h*-d+l*e,c[11]=i*-d+m*e,c},mat4.rotateY=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[0],g=a[1],h=a[2],i=a[3],j=a[8],k=a[9],l=a[10],m=a[11];return c?a!=c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=f*e+j*-d,c[1]=g*e+k*-d,c[2]=h*e+l*-d,c[3]=i*e+m*-d,c[8]=f*d+j*e,c[9]=g*d+k*e,c[10]=h*d+l*e,c[11]=i*d+m*e,c},mat4.rotateZ=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[0],g=a[1],h=a[2],i=a[3],j=a[4],k=a[5],l=a[6],m=a[7];return c?a!=c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=f*e+j*d,c[1]=g*e+k*d,c[2]=h*e+l*d,c[3]=i*e+m*d,c[4]=f*-d+j*e,c[5]=g*-d+k*e,c[6]=h*-d+l*e,c[7]=i*-d+m*e,c},mat4.frustum=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=e*2/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=e*2/i,g[6]=0,g[7]=0,g[8]=(b+a)/h,g[9]=(d+c)/i,g[10]=-(f+e)/j,g[11]=-1,g[12]=0,g[13]=0,g[14]=-(f*e*2)/j,g[15]=0,g},mat4.perspective=function(a,b,c,d,e){var f=c*Math.tan(a*Math.PI/360),g=f*b;return mat4.frustum(-g,g,-f,f,c,d,e)},mat4.ortho=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=2/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2/i,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=-2/j,g[11]=0,g[12]=(a+b)/h,g[13]=(d+c)/i,g[14]=(f+e)/j,g[15]=1,g},mat4.lookAt=function(a,b,c,d){d||(d=mat4.create());var e=a[0],f=a[1],g=a[2],h=c[0],i=c[1],j=c[2],k=b[0],l=b[1],m=b[2];if(e==k&&f==l&&g==m)return mat4.identity(d);var n,o,p,q,r,s,t,u,v,w;return n=e-b[0],o=f-b[1],p=g-b[2],w=1/Math.sqrt(n*n+o*o+p*p),n*=w,o*=w,p*=w,q=i*p-j*o,r=j*n-h*p,s=h*o-i*n,w=Math.sqrt(q*q+r*r+s*s),w?(w=1/w,q*=w,r*=w,s*=w):(q=0,r=0,s=0),t=o*s-p*r,u=p*q-n*s,v=n*r-o*q,w=Math.sqrt(t*t+u*u+v*v),w?(w=1/w,t*=w,u*=w,v*=w):(t=0,u=0,v=0),d[0]=q,d[1]=t,d[2]=n,d[3]=0,d[4]=r,d[5]=u,d[6]=o,d[7]=0,d[8]=s,d[9]=v,d[10]=p,d[11]=0,d[12]=-(q*e+r*f+s*g),d[13]=-(t*e+u*f+v*g),d[14]=-(n*e+o*f+p*g),d[15]=1,d},mat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};var quat4={};quat4.create=function(a){var b=new glMatrixArrayType(4);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b},quat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},quat4.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];return!b||a==b?(a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a):(b[0]=c,b[1]=d,b[2]=e,b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),b)},quat4.inverse=function(a,b){return!b||a==b?(a[0]*=1,a[1]*=1,a[2]*=1,a):(b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3],b)},quat4.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},quat4.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);return g==0?(b[0]=0,b[1]=0,b[2]=0,b[3]=0,b):(g=1/g,b[0]=c*g,b[1]=d*g,b[2]=e*g,b[3]=f*g,b)},quat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=b[0],i=b[1],j=b[2],k=b[3];return c[0]=d*k+g*h+e*j-f*i,c[1]=e*k+g*i+f*h-d*j,c[2]=f*k+g*j+d*i-e*h,c[3]=g*k-d*h-e*i-f*j,c},quat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],g=a[0],h=a[1],i=a[2],j=a[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return c[0]=k*j+n*-g+l*-i-m*-h,c[1]=l*j+n*-h+m*-g-k*-i,c[2]=m*j+n*-i+k*-h-l*-g,c},quat4.toMat3=function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[1]=k-r,b[2]=l+q,b[3]=k+r,b[4]=1-(j+o),b[5]=n-p,b[6]=l-q,b[7]=n+p,b[8]=1-(j+m),b},quat4.toMat4=function(a,b){b||(b=mat4.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[1]=k-r,b[2]=l+q,b[3]=0,b[4]=k+r,b[5]=1-(j+o),b[6]=n-p,b[7]=0,b[8]=l-q,b[9]=n+p,b[10]=1-(j+m),b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},quat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var exports;exports!==undefined&&(exports.glMatrixArrayType=glMatrixArrayType,exports.mat4=mat4,exports.quat4=quat4,exports.mat3=mat3,exports.vec3=vec3),vec3.createFixedPool=function(a){var b=[];while(a--)b.push(vec3.create());return b},mat4.decompose=function(a,b){b=b||{};var c=b.translation=b.translation||vec3.create([0,0,0]),d=b.scale=b.scale||vec3.create([1,1,1]),e=b.rotation=b.rotation||quat4.create([0,0,0,1]);c[0]=a[12],c[1]=a[13],c[2]=a[14],d[0]=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d[1]=Math.sqrt(a[4]*a[4]+a[5]*a[5]+a[6]*a[6]),d[2]=Math.sqrt(a[8]*a[8]+a[9]*a[9]+a[10]*a[10])},mat4.compose=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=c[0],j=c[1],k=c[2],l=e+e,m=f+f,n=g+g,o=e*l,p=e*m,q=e*n,r=f*m,s=f*n,t=g*n,u=h*l,v=h*m,w=h*n;d[0]=(1-(r+t))*i,d[1]=(p-w)*j,d[2]=(q+v)*k,d[3]=0,d[4]=(p+w)*i,d[5]=(1-(o+t))*j,d[6]=(s-u)*k,d[7]=0,d[8]=(q-v)*i,d[9]=(s+u)*j,d[10]=(1-(o+r))*k,d[11]=0,d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=1},function(a){var b=function(a){a?(this.minX=a.minX||Number.POSITIVE_INFINITY,this.plusX=a.plusX||Number.NEGATIVE_INFINITY,this.minY=a.minY||Number.POSITIVE_INFINITY,this.plusY=a.plusY||Number.NEGATIVE_INFINITY,this.minZ=a.minZ||Number.POSITIVE_INFINITY,this.plusZ=a.plusZ||Number.NEGATIVE_INFINITY):(this.minX=Number.POSITIVE_INFINITY,this.plusX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.plusY=Number.NEGATIVE_INFINITY,this.minZ=Number.POSITIVE_INFINITY,this.plusZ=Number.NEGATIVE_INFINITY)};b.prototype.getBoundingFromPoints=function(a){this.minX=Number.POSITIVE_INFINITY,this.plusX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.plusY=Number.NEGATIVE_INFINITY,this.minZ=Number.POSITIVE_INFINITY,this.plusZ=Number.NEGATIVE_INFINITY;var b=a.length,c,d,e;for(var f=0;f<b;f+=3)c=a[f],d=a[f+1],e=a[f+2],c<this.minX&&(this.minX=c),c>this.plusX&&(this.plusX=c),d<this.minY&&(this.minY=d),d>this.plusY&&(this.plusY=d),e<this.minZ&&(this.minZ=e),e>this.plusZ&&(this.plusZ=e)};var c=vec3.createFixedPool(8);b.prototype.toAABB=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=a[12],m=a[13],n=a[14],o=this.minX,p=this.minY,q=this.minZ,r=this.plusX,s=this.plusY,t=this.plusZ,u=c*o,v=d*o,w=e*o,x=c*r,y=d*r,z=e*r,A=f*p,B=g*p,C=h*p,D=f*s,E=g*s,F=h*s,G=i*q,H=j*q,I=k*q,J=i*t,K=j*t,L=k*t,M,N,O,P,Q,R;u<x?(M=u,P=x):(M=x,P=u),A<D?(N=A,Q=D):(N=D,Q=A),G<J?(O=G,Q=J):(O=J,R=G),b.minX=M+N+O+l,b.plusX=P+Q+R+l,v<y?(M=v,P=y):(M=y,P=v),B<E?(N=B,Q=E):(N=E,Q=B),H<K?(O=H,Q=K):(O=K,R=H),b.minY=M+N+O+m,b.plusY=P+Q+R+m,w<z?(M=w,P=z):(M=z,P=v),C<F?(N=C,Q=F):(N=F,Q=C),I<L?(O=I,Q=L):(O=L,R=I),b.minZ=M+N+O+n,b.plusZ=P+Q+R+n},EWGL.boundingBox=b}(EWGL),function(a){var b=function(){this.radius=0,this.radiusSquared=0};b.prototype.getBoundingFromPoints=function(a){var b=0,c=0,d=0,e=0,f=0,g=a.length;for(var h=0;h<g;h+=3)b=a[h],c=a[h+1],d=a[h+2],f=b*b+c*c+d*d,e<f&&(e=f);this.radius=Math.sqrt(e),this.radiusSquared=e},a.boundingSphere=b}(EWGL),function(a){var b=function(a){this.normal=vec3.create(),this.distance=0};b.prototype.setCoefficients=function(a,b,c,d){var e=Math.sqrt(a*a+b*b+c*c);vec3.set([a/e,b/e,c/e],this.normal),this.distance=d/e},a.plane=b}(EWGL),function(a){var b=a.plane,c=function(a){this.near=new b,this.far=new b,this.left=new b,this.right=new b,this.bottom=new b,this.top=new b,this.planes=[this.near,this.far,this.left,this.right,this.bottom,this.top],this.cameraMatrix=mat4.create()};c.prototype.extractPlanes=function(a,b){var c=this.cameraMatrix,d=function(a,b){return c[b*4+a-5]};mat4.multiply(a,b,c),this.near.setCoefficients(d(3,1)+d(4,1),d(3,2)+d(4,2),d(3,3)+d(4,3),d(3,4)+d(4,4)),this.far.setCoefficients(-d(3,1)+d(4,1),-d(3,2)+d(4,2),-d(3,3)+d(4,3),-d(3,4)+d(4,4)),this.bottom.setCoefficients(d(2,1)+d(4,1),d(2,2)+d(4,2),d(2,3)+d(4,3),d(2,4)+d(4,4)),this.top.setCoefficients(-d(2,1)+d(4,1),-d(2,2)+d(4,2),-d(2,3)+d(4,3),-d(2,4)+d(4,4)),this.left.setCoefficients(d(1,1)+d(4,1),d(1,2)+d(4,2),d(1,3)+d(4,3),d(1,4)+d(4,4)),this.right.setCoefficients(-d(1,1)+d(4,1),-d(1,2)+d(4,2),-d(1,3)+d(4,3),-d(1,4)+d(4,4))},c.prototype.AABBisInFrustrum=function(a){for(var b=0;b<6;b++){var c=vec3.create([a.minX,a.minY,a.minZ]),d=this.planes[b];d.normal[0]>0&&(c[0]=a.plusX),d.normal[1]>0&&(c[1]=a.plusY),d.normal[2]>0&&(c[2]=a.plusZ);if(d.distance+d.normal[0]*c[0]+d.normal[1]*c[1]+d.normal[2]*c[2]<0)return console.log(b),!1}return!0},c.prototype.isInFrustrum=function(a,b,c){radius=-c.radius*Math.max(b[0],Math.max(b[1],b[2]));for(var d=0;d<6;d++){var e=this.planes[d],f=e.normal;distance=f[0]*a[0]+f[1]*a[1]+f[2]*a[2]+e.distance;if(distance<=radius)return!1}return!0},c.create=function(a){return new c(a)},a.frustrum=c}(EWGL),function(a){var b,c=0,d={mappings:{},updateCallbacks:[]};d.addMapping=function(a,b){d.mappings[a]=d.mappings[a]||[],d.mappings[a].push(b)},d.mappingExists=function(a){return!!d.mappings[a]},d.update=function(a){var b,c=d.updateCallbacks.length;for(b=0;b<c;b++)d.updateCallbacks[b](a)},d.createAddHandler=function(a){return function(b){var e,f,g,h,i;if(!b.func&&!b.name)throw"there should always be a function mapped to the key:{"+i+" : "+f+"};";e=b.func,f=b.name||Handler+c++,i=b.keyName||0,e&&d.addMapping(f,e),a[i]=a[i]||[],a[i].push({name:f})}},d.activateAction=function(a,b){var c,e,f;if(d.mappings[a]){f=d.mappings[a],e=f.length;for(c=0;c<e;c++)f[c](b)}},a.inputManager=d}(EWGL),function(a){var b=EWGL.inputManager,c={},d={},e={},f={},g={};g.BACKSPACE=8,g.TAB=9,g.ENTER=13,g.SHIFT=16,g.CTRL=17,g.ALT=18,g.PAUSE_BREAK=19,g.CAPS_LOCK=20,g.ESCAPE=27,g.PAGE_UP=33,g.PAGE_DOWN=34,g.END=35,g.HOME=36,g.LEFT_ARROW=37,g.UP_ARROW=38,g.RIGHT_ARROW=39,g.DOWN_ARROW=40,g.INSERT=45,g.DELETE=46,g[0]=48,g[1]=49,g[2]=50,g[3]=51,g[4]=52,g[5]=53,g[6]=54,g[7]=55,g[8]=56,g[9]=57,g.A=65,g.B=66,g.C=67,g.D=68,g.E=69,g.F=70,g.G=71,g.H=72,g.I=73,g.J=74,g.K=75,g.L=76,g.M=77,g.N=78,g.O=79,g.P=80,g.Q=81,g.R=82,g.S=83,g.T=84,g.U=85,g.V=86,g.W=87,g.X=88,g.Y=89,g.Z=90,g.LEFT_WINDOW_KEY=91,g.RIGHT_WINDOW_KEY=92,g.SELECT_KEY=93,g.NUMPAD_0=96,g.NUMPAD_1=97,g.NUMPAD_2=98,g.NUMPAD_3=99,g.NUMPAD_4=100,g.NUMPAD_5=101,g.NUMPAD_6=102,g.NUMPAD_7=103,g.NUMPAD_8=104,g.NUMPAD_9=105,g.MULTIPLY=106,g.ADD=107,g.SUBTRACT=109,g.DECIMAL_POINT=110,g.DIVIDE=111,g.F1=112,g.F2=113,g.F3=114,g.F4=115,g.F5=116,g.F6=117,g.F7=118,g.F8=119,g.F9=120,g.F10=121,g.F11=122,g.F12=123,g.NUM_LOCK=144,g.SCROLL_LOCK=145,g.SEMI_COLON=186,g.EQUAL_SIGN=187,g.COMMA=188,g.DASH=189,g.PERIOD=190,g.FORWARD_SLASH=191,g.GRAVE_ACCENT=192,g.OPEN_BRACKET=219,g.BACK_SLASH=220,g.CLOSE_BRAKET=221,g.SINGLE_QUOTE=222,g.SPACE=32;var h=function(a){var b=a.which,c=d[b],e,g,h;if(c&&!f[b]){e=c.length;for(h=0;h<e;h++)inputmanager.activateAction(c[h].name,a)}f[b]=!0},i=function(a){var c=a.which,d=e[c],g,h,i;if(d){g=d.length;for(i=0;i<g;i++)b.activateAction(d[i].name,a)}f[c]&&delete f[c]},j=function(a){var d,e,g,h,i;for(d in f){i=c[d];if(i&&d){e=i.length;for(h=0;h<e;h++)b.activateAction(i[h].name,a)}}};document.addEventListener("keydown",h,!0),document.addEventListener("keyup",i,!0),b.updateCallbacks.push(j),b.addKeyHandler=b.createAddHandler(c),b.addKeyUpHandler=b.createAddHandler(e),b.addKeyDownHandler=b.createAddHandler(d),b.keyboard={},b.keyboard.keys=g,b.keyboard.keyspressed=f}(EWGL),function(a){function p(a){var c=0;a||(a=window.event),a.wheelDelta?(c=a.wheelDelta/120,window.opera&&(c=-c)):a.detail&&(c=-a.detail/3);var d=g[0],e,f,h;if(d){e=d.length;for(h=0;h<e;h++)b.activateAction(d[h].name,c)}a.preventDefault&&(a.preventDefault(),a.returnValue=!1)}var b=a.inputManager,c={};c.NONE=0,c.LEFT=1,c.MIDDLE=2,c.RIGHT=3;var d={},e={},f={},g={},h={},i=0,j={},k=[],l=[];h[c.NONE]=!0,h[c.LEFT]=!1,h[c.MIDDLE]=!1,h[c.RIGHT]=!1;var m=function(a){var c,e,f,g,i;a.mouse={};for(c in h)if(h[c]===!0){i=d[c],a.mouse.startPosition=j[c],a.mouse.prevPosition=k,a.mouse.position=l;if(i&&c){e=i.length;for(g=0;g<e;g++)b.activateAction(i[g].name,a)}}k=l},n=function(a){var d=a.which,e=f[d],g,i,l;if(e&&!h[d]){g=e.length;for(l=0;l<g;l++)b.activateAction(e[l].name,a)}h[c.NONE]=!1,h[d]=!0,j[d]=[a.screenX,a.screenY],k=[a.screenX,a.screenY]},o=function(a){var d=a.which,f=e[d],g,i,j;if(f){g=f.length;for(j=0;j<g;j++)b.activateAction(f[j].name,a)}h[d]=!1,!h[c.LEFT]&&!h[c.MIDDLE]&&!h[c.RIGHT]&&(h[c.NONE]=!0)},q=function(a){l=[a.screenX,a.screenY]};document.addEventListener("mousedown",n,!0),document.addEventListener("mouseup",o,!0),document.addEventListener("mousemove",q,!0),window.addEventListener("DOMMouseScroll",p,!0),window.onmousewheel=document.onmousewheel=p,b.updateCallbacks.push(m),b.addMouseDragHandler=b.createAddHandler(d),b.addMouseUpHandler=b.createAddHandler(e),b.addMouseWheelHandler=b.createAddHandler(g),b.addMouseDownHandler=b.createAddHandler(f),b.mouse={},b.mouse.mouseButtons=c,b.mouse.mousePressed=h}(EWGL),function(a){var b,c,d={},e=0,f=0;Object.defineProperties(d,{_canvas:{value:c,configurable:!0,writable:!0},canvas:{get:function(){return d._canvas},set:function(a){d._canvas!==a&&(g(d),h(d),d._canvas=a,i(d),j(d),k(d))}},_gl:{value:c,configurable:!0,writable:!0},gl:{get:function(){return d._gl}},backcolor:{value:[0,0,0,1]},_camera:{value:c,configurable:!0,writable:!0},camera:{get:function(){return d._camera},set:function(a){a!==d._camera&&(d._camera=a,a.updateView(d.canvas))}}});var g=function(a){},h=function(a){},i=function(a){var b=a._canvas.getContext("experimental-webgl");a._gl=b},j=function(a){},k=function(a){a._camera&&a._camera.updateView(a.canvas),a.backcolor&&a.gl.clearColor(a.backcolor[0],a.backcolor[1],a.backcolor[2],a.backcolor[3]),a.gl.frontFace(a.gl.CCW),a.gl.cullFace(a.gl.BACK),a.gl.enable(a.gl.CULL_FACE),a.gl.enable(a.gl.DEPTH_TEST),a.gl.clear(a.gl.COLOR_BUFFER_BIT|a.gl.DEPTH_BUFFER_BIT)};d.clear=function(){d.gl.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT)},d.createShaderProgram=function(a,b){var c=d.gl,e=+(new Date),f=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(f,b),c.compileShader(f);if(!c.getShaderParameter(f,c.COMPILE_STATUS))return alert(c.getShaderInfoLog(f)),null;console.log("fragshader alone:"+(+(new Date)-e)),e=+(new Date);var g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,a),c.compileShader(g);if(!c.getShaderParameter(g,c.COMPILE_STATUS))return alert(c.getShaderInfoLog(g)),null;console.log("vertshader alone:"+(+(new Date)-e)),e=+(new Date);var h=c.createProgram();return c.attachShader(h,g),c.attachShader(h,f),c.linkProgram(h),console.log("linkshader alone:"+(+(new Date)-e)),e=+(new Date),c.getProgramParameter(h,c.LINK_STATUS)||alert("Could not initialise shaders"),c.useProgram(h),h.info={},h.info.vertexshader=a,h.info.fragmentshader=b,h},d.getAttribute=function(a,b){var c=d.gl,e=c.getAttribLocation(a,b);return c.enableVertexAttribArray(e),e},d.getUniform=function(a,b){return d.gl.getUniformLocation(a,b)},d.AdjustGLBuffer=function(a){var b=d.gl,c,e=a.getData();c=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,c),b.bufferData(b.ARRAY_BUFFER,new Float32Array(e),b.STATIC_DRAW),a.glObject=c,a.flags.dataChanged=!1},d.AdjustGLELMENTBuffer=function(a){var b=d.gl,c,e=a.getData();c=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),b.STATIC_DRAW),a.glObject=c,a.flags.dataChanged=!1},usedShaderProgram=c,d.useProgram=function(a){usedShaderProgram!==a&&(d.gl.useProgram(a),usedShaderProgram=a)},a.renderer=d}(EWGL),function(a){var b,c=0,d=function(){this.meshId="mesh"+c++,this.flags={},this.vertexbuffers={}};d.prototype.addNewVertexbuffer=function(a){if(!a)throw"Always create a vertexbuffer with at least some args";a.mesh=this;var b=new e(a);this.vertexbuffers[a.type]=b};var e=function(a){var c;this.flags={},this.type=a.type,this._mesh=a.mesh,this.glObject=b,this.size=0,this.listeners=[],this.setData=function(a){var b=d.flagsToSet[this.type];c=a,this.size=c.length,this.flags.dataChanged=!0;if(b)for(var e=0,f=b.length;e<f;e++)this._mesh.flags[b[e]]=!0},this.getData=function(){return c},this.setData(a.data||[])},f={};f.position="position",f.color="color",f.texture="texture",f.indices="indices",d.flagsToSet={},d.addFlagsToSet=function(a,b){d.flagsToSet[a]=d.flagsToSet[a]||[],d.flagsToSet[a].push(b)},a.mesh=d,a.vertexbufferType=f}(EWGL),function(a){var b,c=new Image,d=function(a){a=a||{},this.texture=b,this.flags={},this.image=a.img||b};a.texture=d}(EWGL),function(a){var b,c=function(a){this.renderer=a.renderer,this.vsMain=a.main||b,this.fsMain=a.main||b,this.extensions=a.extensions||[],this.uniforms={},this.attributes={},this.program=b,this.stack=[]};c.prototype.use=function(){var a,b=this.vsMain,c=this.fsMain,d=this.extensions,e="",f=b.calculateID&&b.calculateID()||0;e+="V"+b+","+f;var g=c.calculateID&&c.calculateID()||0;e+="F"+c+","+g;var h=[];for(i=0,l=d.length;i<l;i++)shaderExt=d[i],h[i]=shaderExt.calculateID&&shaderExt.calculateID()||0,e+="E"+shaderExt.shaderExtensionCounter+","+h[i];return this.stack[e]?(a=this.stack[e].program,this.uniforms=this.stack[e].uniforms,this.attributes=this.stack[e].attributes,this.renderer.useProgram(a),this.program=a):(this.generateShaderExts(f,g,h),a=this.renderer.createShaderProgram(this.compose(this.vsMain,this.extensions,this.vsMain.type),this.compose(this.fsMain,this.extensions,this.fsMain.type)),this.renderer.useProgram(a),this.program=a,this.initializeProgram(this,f,g,h),this.stack[e]={},this.stack[e].program=a,this.stack[e].uniforms=this.uniforms,this.stack[e].attributes=this.attributes),this},c.prototype.initializeProgram=function(a,b,c,d){this.uniforms={},this.attributes={},this.vsMain.getShaderInputs(a,b),this.fsMain.getShaderInputs(a,c);for(i=0,l=this.extensions.length;i<l;i++)this.extensions[i].getShaderInputs(a,d[i])},c.prototype.generateShaderExts=function(a,b,c){var d=this.vsMain,e=this.fsMain,f=this.extensions;d.generateShaderPieces(a),e.generateShaderPieces(b);for(i=0,l=f.length;i<l;i++)shaderExt=f[i],shaderExt.generateShaderPieces(c[i])},c.prototype.compose=function(a,b,c){var d,e,f,g,h=a.preprocessor,i=a.uniforms,j=a.attributes,k=a.varyings,l=a.program;for(d=0,e=b.length;d<e;d++)f=b[d],f.type==c&&(h+=f.preprocessor,j+=f.attributes,i+=f.uniforms,k+=f.varyings,l+=f.program);return g=h+"\n"+j+"\n"+i+"\n"+k+"\n"+"void main() {\n"+l+"}",g},a.shaderProgram=c}(EWGL),function(a){var b=0,c=function(a){this.shaderExtensionCounter=b++,this.type=a.type,this.preprocessor=a.preprocessor||"",this.uniforms=a.uniforms||"",this.attributes=a.attributes||"",this.varyings=a.varyings||"",this.functionDeclarations=a.functionDeclarations||"",this.programPieces=a.programPieces||{},this.program=a.program||"",this.stack={},Object.defineProperties(this,{_changed:{value:!0,configurable:!0,writable:!0},changed:{get:function(){return this._changed}},_idNumber:{value:-1,configurable:!0,writable:!0},idNumber:{get:function(){return this._idNumber},set:function(a){a===this._idNumber?this._changed=!1:(this._changed=!0,this._idNumber=a,this.stack[a]||(this.stack[a]={preprocessor:this.preprocessor,uniforms:this.uniforms,attributes:this.attributes,varyings:this.varyings,functionDeclarations:this.functionDeclarations,programPieces:this.programPieces,program:this.program}))}}})};c.prototype.calculateID=function(){return-1},c.prototype.generateShaderPieces=function(a){},c.prototype.getShaderInputs=function(a,b){},c.prototype.setShaderPieces=function(a,b){},c.prototype.setFrameInputs=function(a,b){},c.prototype.setObjectInputs=function(a,b){},c.prototype.clear=function(){this.preprocessor="",this.uniforms="",this.attributes="",this.varyings="",this.functionDeclarations="",this.programPieces={},this.program=""},c.prototype.fullClear=function(){this.preprocessor="",this.uniforms="",this.attributes="",this.varyings="",this.functionDeclarations="",this.programPieces={},this.program="",this.stack=[],this.idNumber=-1},c.prototype.addAttribute=function(a,b){this.attributes+="attribute "+b+" "+a+";\n"},c.prototype.addUniform=function(a,b){this.uniforms+="uniform "+b+" "+a+";\n"},c.prototype.addVarying=function(a,b){this.varyings+="varying "+b+" "+a+";\n"},c.prototype.appendProgram=function(a){this.program+=a+"\n"},c.prototype.addPreprocessor=function(a){this.preprocessor+=a+"\n\n"},c.prototype.useId=function(a){var b=this.stack[a];this.preprocessor=b.preprocessor,this.uniforms=b.uniforms,this.attributes=b.attributes,this.varyings=b.varyings,this.functionDeclarations=b.functionDeclarations,this.programPieces=b.programPieces,this.program=b.program},c.types={vertex:35633,fragment:35634},c.uniform={},c.uniform.types={vec2:"vec2",vec3:"vec3",vec4:"vec4",mat3:"mat3",mat4:"mat4",sampler2D:"sampler2D"},c.varying={},c.varying.types={vec2:"vec2",vec3:"vec3",vec4:"vec4",mat3:"mat3",mat4:"mat4"},a.shaderExtension=c}(EWGL),function(a){var b=EWGL.list,c=0,d,e,f=function(a){var e=a||{};return this.name=e.name,this.id="node"+c++,this.flags={},this.controllers=[],this._rotation=quat4.create(),this._translation=vec3.create(),this._scale=vec3.create(),this.rotation=e.rotation||quat4.create([0,0,0,1]),this.translation=e.translation||vec3.create(),this.scale=e.scale||vec3.create([1,1,1]),this._worldRotation=quat4.create([0,0,0,1]),this._worldTranslation=vec3.create([0,0,0]),this._worldScale=vec3.create([1,1,1]),this._matrix=mat4.create(),this._worldInfo={worldScale:this._worldScale,worldTranslation:this._worldTranslation,worldRotation:this._worldRotation,matrix:this._matrix},this._boundingBox=new EWGL.boundingBox,this.parent=e.parent||d,this.children=new b(e.children),this};Object.defineProperties(f.prototype,{_name:{value:d,configurable:!0,writable:!0},name:{get:function(){return this._name},set:function(a){if(a){if(a===this._name)return;if(!f.Nodes[a])f.Nodes[this._name]&&(f.Nodes[this._name]=d),this._name=a,f.Nodes[a]=this;else throw"All Nodes need a different name : "+a+" is at least added twice."}else f.Nodes[this._name]&&(f.Nodes[this._name]=d),this._name=d}},_id:{value:d,configurable:!0,writable:!0},id:{get:function(){return this._id},set:function(a){if(!a)throw"All Nodes need at least One Id.";if(a===this._id)return;if(!f.NodesById[a])f.NodesById[this._id]&&(f.NodesById[this._id]=d),this._id=a,f.NodesById[a]=this;else throw"All Nodes need a different id: "+a+" is at least added twice."}},_rotation:{value:quat4.create([0,0,0,1]),configurable:!0,writable:!0},rotation:{get:function(){return this._rotation},set:function(a){quat4.set(a,this._rotation),this.setUpdateMatrixFlag(),this.setUpdateBoundingBoxFlag()}},_translation:{value:vec3.create(),configurable:!0,writable:!0},translation:{get:function(){return this._translation},set:function(a){vec3.set(a,this._translation),this.setUpdateMatrixFlag(),this.setUpdateBoundingBoxFlag()}},_scale:{value:vec3.create(),configurable:!0,writable:!0},scale:{get:function(){return this._scale},set:function(a){a.length||(a=[a,a,a]),vec3.set(a,this._scale),this.setUpdateMatrixFlag(),this.setUpdateBoundingBoxFlag()}},flags:{value:{},configurable:!0,writable:!0},_children:{value:[],configurable:!0,writable:!0},children:{get:function(){return this._children},set:function(a){if(b.isList(a)){this._children=a;var c=this;a.itemAdded=function(a){a._parent=c,c.flags.hasChildren=!0},a.itemRemoved=function(b){b._parent=d,a.length===0&&(c.flags.hasChildren=!1)}}}},_parent:{value:d,configurable:!0,writable:!0},parent:{get:function(){return this._parent},set:function(a){a!==this._parent&&(k(this,a),this.setUpdateMatrixFlag())}},_matrix:{value:d,configurable:!0,writable:!0},matrix:{get:function(){return this.flags.UpdateMatrix&&n(this),this._matrix}},_worldScale:{value:d,configurable:!0,writable:!0},worldScale:{get:function(){return this.flags.UpdateMatrix&&n(this),this._worldScale}},_worldTranslation:{value:d,configurable:!0,writable:!0},worldTranslation:{get:function(){return this.flags.UpdateMatrix&&n(this),this._worldTranslation}},_worldRotation:{value:d,configurable:!0,writable:!0},worldRotation:{get:function(){return this.flags.UpdateMatrix&&n(this),this._worldRotation}},_worldInfo:{value:d,configurable:!0,writable:!0},worldInfo:{get:function(){return this.flags.UpdateMatrix&&n(this),this._worldInfo}},_boundingBox:{value:d,configurable:!0,writable:!0},boundingBox:{get:function(){return this.flags.UpdateBoundingBox&&l(this),this._boundingBox}},controllers:{value:[],configurable:!0,writable:!0},lastUpdate:{value:-1,configurable:!0,writable:!0}}),f.prototype.update=function(a){this.lastUpdate=a.counter;var b,c=this.controllers.length;for(b=0;b<c;b++)this.controllers[b].update(a);if(this.flags.hasChildren){var d,e=this.children,f=e.length;for(d=0;d<f;d++)e[d].update(a)}},f.prototype.render=function(a){var b,c=this.children.length;for(b=0;b<c;b++)this.children[b].render(a)},f.prototype.setUpdateMatrixFlag=function(){h(this)},f.prototype.setUpdateBoundingBoxFlag=function(){g(this)},f.prototype.removeAllChildren=function(){removeAllChildren(this)},f.prototype.addChildren=function(a){i(this,a)},f.prototype.addController=function(a){a.node=this,this.controllers.push(a)},f.prototype.addChild=function(a){i(this,a)},f.prototype.removeParent=function(){j(this)},f.prototype.setParent=function(a){k(this,a)},f.prototype._calculateUpdateMatrix=function(){n(this)};var g=function(a){a.flags.UpdateBoundingBox||(a.flags.UpdateBoundingBox=!0,a.parent&&a.parent.setUpdateBoundingBoxFlag())},h=function(a){var b,c,d;if(!a.flags.UpdateMatrix){a.flags.UpdateMatrix=!0,d=a.children,c=d.length;for(b=0;b<c;b++)d[b].setUpdateMatrixFlag()}},i=function(a,b){var c,d,e,f;b&&(d=b.length,d?a.children.addRange(b):a.children.add(b))},j=function(a){a.parent!==d&&a.parent.children.remove(a)},k=function(a,b){a.parent!==d&&a.removeParent(),a._parent=b,b!==d&&a._parent._children.add(a)},l=function(a){var b=a.children,c=b.length,d,e=a._boundingBox,f;if(a.flags.UpdateBoundingBox){e.minX=Number.POSITIVE_INFINITY,e.plusX=Number.NEGATIVE_INFINITY,e.minY=Number.POSITIVE_INFINITY,e.plusY=Number.NEGATIVE_INFINITY,e.minZ=Number.POSITIVE_INFINITY,e.plusZ=Number.NEGATIVE_INFINITY;for(d=0;d<c;d++){f=b[d].boundingBox;if(f.minX!==Number.POSITIVE_INFINITY||f.plusX!==Number.NEGATIVE_INFINITY||f.minY!==Number.POSITIVE_INFINITY||f.plusY!==Number.NEGATIVE_INFINITY||f.minZ!==Number.POSITIVE_INFINITY||f.plusZ!==Number.NEGATIVE_INFINITY)f.minX<e.minX&&(e.minX=f.minX),f.plusX>e.plusX&&(e.plusX=f.plusX),f.minY<e.minY&&(e.minY=f.minY),f.plusY>e.plusY&&(e.plusY=f.plusY),f.minZ<e.minZ&&(e.minZ=f.minZ),f.plusZ>e.plusZ&&(e.plusZ=f.plusZ)}}},m=mat4.create(),n=function(a){var b=a.parent,c=a.scale,d=a.rotation,e=a.translation,f=a._matrix,g=a._worldScale,h=a._worldRotation,i=a._worldTranslation;if(a.flags.UpdateMatrix){if(b){var j=b.worldInfo,k=j.worldScale,l=j.worldRotation,m=j.worldTranslation;vec3.scaleVec3(c,k,g),quat4.multiply(l,d,h),quat4.multiplyVec3(l,e,i),vec3.scaleVec3(i,k),vec3.add(i,m)}else vec3.set(a._scale,g),quat4.set(a._rotation,h),vec3.set(a._translation,i);mat4.compose(i,h,g,f),a.flags.UpdateMatrix=!1,a.flags.MatrixUpdated=!0}};nexboundingboxCounter=0,f.prototype.showBounds=function(){if(EWGL.DEBUG&&!this.flags.hasBoundingBoxOutline){for(var a=0;a<this.children.length;a++)this.children[a].showBounds();this.flags.hasBoundingBoxOutline=!0,this.attachNewBoundingBoxOutline()}},f.$=function(a){return f.Nodes[a]},f.getById=function(a){return f.NodesById[a]},f.prototype.attachNewNode=function(a){return a=a||{},a.parent=this,new f(a)},f.Nodes={},f.NodesById={},a.node=f}(EWGL),function(a){var b=EWGL.node,c=b.prototype;c.translate=function(a){vec3.add(this.translation,a),this.setTransformFlag()},c.rotate=function(a){quat4.multiply(this.rotation,a),this.setTransformFlag()},c.lookAt=function(a,b){var c,d,e=b||vec3.create([0,1,0]);c=vec3.direction(this.worldTranslation,a,vec3.create()),d=vec3.create(e),vec3.cross(d,c),vec3.normalize(d),d[0]===0&&d[1]===0&&d[2]===0&&(c[0]!==0?vec3.set([c[1],-c[0],0],d):vec3.set([0,c[2],-c[1]],d)),e=vec3.create(c),vec3.cross(e,d),vec3.normalize(e);var f=d[0],g=e[0],h=c[0],i=d[1],j=e[1],k=c[1],l=d[2],m=e[2],n=c[2],o=f+j+n,p,q,r,s,t;o>0?(p=Math.sqrt(o+1)*2,t=.25*p,q=(k-m)/p,r=(l-h)/p,s=(g-i)/p):f>j&&f>n?(p=Math.sqrt(1+f-j-n)*2,q=p*.25,r=(g+i)/p,s=(l+h)/p,t=(k-m)/p):j>n?(p=Math.sqrt(1+j-f-n)*2,r=p*.25,q=(g+i)/p,s=(k+m)/p,t=(l-h)/p):(p=Math.sqrt(1+n-f-j)*2,s=p*.25,q=(l+h)/p,r=(k+m)/p,t=(g-i)/p),this.rotation=quat4.create([q,r,s,t]),quat4.normalize(this.rotation)},c.lookAt2=function(a,b){var c,d,e=b||[0,1,0];c=vec3.direction(a,this.worldTranslation,[]),c[2]=-c[2],d=vec3.create(e),vec3.cross(d,c),vec3.normalize(d),d[0]===0&&d[1]===0&&d[2]===0&&(c[0]!==0?vec3.set([c[1],-c[0],0],d):vec3.set([0,c[2],-c[1]],d)),e=vec3.create(c),vec3.cross(e,d),vec3.normalize(e);var f=d[0],g=e[0],h=c[0],i=d[1],j=e[1],k=c[1],l=d[2],m=e[2],n=c[2],o=f+j+n,p,q,r,s,t;t=Math.sqrt(Math.max(0,1+f+j+n))/2,q=Math.sqrt(Math.max(0,1+f-j-n))/2,r=Math.sqrt(Math.max(0,1-f+j-n))/2,s=Math.sqrt(Math.max(0,1-f-j+n))/2,q=m-k>0?q:-q,r=h-l>0?r:-r,s=i-g>0?s:-s,this.rotation=quat4.create([q,r,s,t]),quat4.normalize(this.rotation),console.log(quat4.toMat3(this.rotation,[]))},c.getUp=function(){var a=quat4.toMat3(this.worldRotation);return[a[3],a[4],a[5]]}}(EWGL),function(a){var b=a.node,c=a.frustrum,d,e=function(a){return b.call(this,a),this._perspective=mat4.create(),this._inverseMatrix=mat4.create(),this.frustrum=c.create(),this};e.prototype=new b,Object.defineProperties(e.prototype,{_fovy:{value:45,configurable:!0,writable:!0},fovy:{get:function(){return this._fovy},set:function(a){this._fovy=a,f(this)}},_aspect:{value:1,configurable:!0,writable:!0},aspect:{get:function(){return this._aspect},set:function(a){this._aspect=a,f(this)}},_near:{value:.1,configurable:!0,writable:!0},near:{get:function(){return this._near},set:function(a){this._near=a,f(this)}},_far:{value:1e4,configurable:!0,writable:!0},far:{get:function(){return this._far},set:function(a){this._far=a,f(this)}},_perspective:{value:mat4.create(),configurable:!0,writable:!0},perspective:{get:function(){return this._perspective}},_inverseMatrix:{value:mat4.create(),configurable:!0,writable:!0},inverseMatrix:{get:function(){return(this.flags.UpdateMatrix||this.flags.MatrixUpdated)&&g(this),this._inverseMatrix}}});var f=function(a){mat4.perspective(a.fovy,a.aspect,a.near,a.far,a._perspective)};e.prototype.updateView=function(a){a?this.aspect=a.width/a.height:this.aspect=1};var g=function(a){mat4.inverse(a.matrix,a._inverseMatrix),a.flags.MatrixUpdated=!1},h=b.prototype.update;e.prototype.update=function(a){h.call(this,a),this.frustrum.extractPlanes(this.perspective,this.inverseMatrix)},a.cameraNode=e}(EWGL),function(a){var b,c=a.node,d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=vec3.createFixedPool(8),g=function(d){return d===b&&(d={}),c.call(this,d),this.mesh=d.mesh||new a.mesh,this.material=d.material||a.materialList.baseMaterial,this.materialOptions=d.materialOptions||{},this};g.prototype=new c,Object.defineProperties(g.prototype,{_mesh:{value:b,configurable:!0,writable:!0},mesh:{get:function(){return this._mesh},set:function(a){if(a!==this._mesh){var c;this._material&&this._mesh&&(c=this._material.meshes[this._mesh.meshId],this._material.geometries[c].splice(this._material.geometries[c].indexOf(this),1)),this._mesh=a,this._mesh.flags.changedMesh=!0,this._material&&this._mesh&&(c=this._material.meshes[this._mesh.meshId],c===b&&(this._material.meshes[this._mesh.meshId]=this._material.geometries.length,c=this._material.geometries.length,this._material.geometries[c]=[]),this._material.geometries[c].push(this))}}},_material:{value:b,configurable:!0,writable:!0},material:{get:function(){return this._material},set:function(a){var c;this._material&&this._mesh&&(c=this._material.meshes[this._mesh.meshId],this._material.geometries[c].splice(this._material.geometries[c].indexOf(this),1)),this._material=a,this.flags.changedMaterial=!0,a&&this._mesh&&(c=this._material.meshes[this._mesh.meshId],c===b&&(this._material.meshes[this._mesh.meshId]=this._material.geometries.length,c=this._material.geometries.length,this._material.geometries[c]=[]),this._material.geometries[c].push(this))}},_boundingBox:{value:b,configurable:!0,writable:!0},boundingBox:{get:function(){return!this.flags.staticBoundingBox&&this.flags.UpdateBoundingBox&&h(this),this._boundingBox}}});var h=function(b){var c=b.mesh,d,e,f;if(!b.flags.NoBoundingBox){c.flags.boundingBoxChanged&&(c.boundingBox||(c.boundingBox=new a.boundingBox),c.boundingBox.getBoundingFromPoints(c.vertexbuffers.position.getData()),c.flags.boundingBoxChanged=!1);var g=b.matrix,h=c.boundingBox,i=b._boundingBox;h.toAABB(g,i)}};g.prototype.setColor=function(a){var b=this.mesh.vertexbuffers;if(!b.position)return;var c=b.position.size/3,d=[];while(c>0)d.push(a[0]),d.push(a[1]),d.push(a[2]),d.push(1),c--;b.color?b.color.setData(d):this.mesh.addNewVertexbuffer({type:"color",data:d})},g.prototype.setTexture=function(a){this.materialOptions.texture=a},g.create=function(a){return new g(a)};var i=c.prototype.update;g.prototype.update=function(a){i.call(this,a),this.material.lastUpdate=a.counter},a.node.prototype.attachNewGeometry=function(a){return a=a||{},a.parent=this,new g(a)},a.mesh.addFlagsToSet("position","boundingBoxChanged"),a.mesh.addFlagsToSet("position","boundingSphereChanged"),a.geometry=g}(EWGL),function(a){var b=a.shaderExtension,c={lights:[],flags:{},types:{ambientLight:1,directionalLight:2},usedLights:{},vsShaderExtension:new b({type:b.types.vertex}),fsShaderExtension:new b({type:b.types.fragment})};c.addLight=function(a){c.lights.push(a),c.flags.changedLights=!0};var d=function(){var a=c.usedLights,b=a[1]&&1||0,d=a[2]&&a[2].length||0;return d*100+b};c.vsShaderExtension.calculateID=d,c.fsShaderExtension.calculateID=d,c.vsShaderExtension.generateShaderPieces=function(a){var d=c.vsShaderExtension,e=a%100,f=(a-e)/100%100,g=b.uniform.types,h=b.varying.types;if(d.stack[a]){d.useId(a);return}d.clear(),e>0?(d.addUniform("uAmbientColor",g.vec3),d.addVarying("vLightWeighting",h.vec3),d.appendProgram("vLightWeighting = uAmbientColor;")):f>0&&(d.addVarying("vLightWeighting",h.vec3),d.appendProgram("vLightWeighting = vec3(0.0,0.0,0.0);"));if(f>=1){d.appendProgram("float directionalWeighting;"),d.appendProgram("vec3 transformedNormal;");for(var i=0;i<f;i++)d.addUniform("uDirectionalColor"+i,g.vec3),d.addUniform("uDirectionalDirection"+i,g.vec3),d.appendProgram("transformedNormal = uNMatrix * aVertexNormal;"),d.appendProgram("directionalWeighting = max(dot(normalize(transformedNormal), normalize(uDirectionalDirection"+i+")), 0.0);"),d.appendProgram("vLightWeighting += uDirectionalColor"+i+" * directionalWeighting;")}d.idNumber=a},c.fsShaderExtension.generateShaderPieces=function(a){var d=c.fsShaderExtension,e=a%100,f=(a-e)/100%100,g=b.varying.types;if(d.stack[a]){d.useId(a);return}d.clear();if(e>=1||f>=1)d.addVarying("vLightWeighting",g.vec3),d.appendProgram("gl_FragColor = vec4(gl_FragColor.rgb * vLightWeighting, gl_FragColor.a);");d.idNumber=a};var e=function(a,b){var c=a.uniforms,d=b%100,e=(b-d)/100%100,f=a.renderer,g,h;d>0&&(c.AmbientUniform=f.getUniform(a.program,"uAmbientColor"));if(e>0)for(g=0,h=e;g<h;g++){var i="directionalLightColor"+g,j="directionalLightDirection"+g;c[i]=f.getUniform(a.program,"uDirectionalColor"+g),c[j]=f.getUniform(a.program,"uDirectionalDirection"+g)}};c.vsShaderExtension.getShaderInputs=e;var f=vec3.create(),g=function(a,b){var d=a.uniforms,e=b%100,g=(b-e)/100%100,h=a.renderer,i=h.gl,j,k;vec3.set([0,0,0],f);if(e>0){for(j=0,k=c.usedLights[1].length;j<k;j++)vec3.add(f,c.usedLights[1][j].color);i.uniform3fv(d.AmbientUniform,f)}if(g>0)for(j=0,k=g;j<k;j++){var l="directionalLightColor"+j,m="directionalLightDirection"+j;i.uniform3fv(d[l],c.usedLights[2][j].color),i.uniform3fv(d[m],c.usedLights[2][j].direction)}};c.vsShaderExtension.setShaderPieces=g,a.lights=c}(EWGL),function(a){var b=a.node,c=a.lights,d,e=function(a){return b.call(this,a),c.addLight(this),this};e.prototype=new b,a.light=e}(EWGL),function(a){var b=a.light,c=a.lights,d=a.node,e=function(a){return b.call(this,a),this.color=a.color||vec3.create([1,1,1]),this};e.prototype=new b,e.prototype.type=c.types.ambientLight,d.prototype.attachNewAmbientLight=function(a){return a=a||{},a.parent=this,new e(a)},a.ambientLight=e}(EWGL),function(a){var b=a.light,c=a.lights,d=a.node,e,f=function(a){return b.call(this,a),this.color=a.color||vec3.create([1,1,1]),this.direction=a.direction||vec3.create([1,1,0]),this};f.prototype=new b,f.prototype.type=c.types.directionalLight,d.prototype.attachNewDirectionalLight=function(a){return a=a||{},a.parent=this,new f(a)},a.directionalLight=f}(EWGL),function(a){var b=a.shaderExtension,c=new a.shaderProgram({renderer:a.renderer}),d=new b({type:b.types.vertex});d.addAttribute("aVertexPosition","vec3"),d.addAttribute("aVertexNormal","vec3"),d.addAttribute("aTexturePosition","vec2"),d.addUniform("uMVMatrix","mat4"),d.addUniform("uPMatrix","mat4"),d.addUniform("uCMatrix","mat4"),d.addUniform("uNMatrix","mat3"),d.addVarying("vTexture","vec2"),d.appendProgram("gl_Position = uPMatrix * (uCMatrix * uMVMatrix) * vec4(aVertexPosition, 1.0);"),d.appendProgram("vTexture = aTexturePosition;"),c.vsMain=d;var e=new b({type:b.types.fragment});e.addPreprocessor("#ifdef GL_ES\n  precision highp float; \n#endif \n"),e.addVarying("vTexture","vec2"),e.addUniform("uSampler","sampler2D"),e.appendProgram("gl_FragColor = texture2D(uSampler, vec2(vTexture.s, vTexture.t));"),c.fsMain=e,c.extensions.push(a.lights.vsShaderExtension),c.extensions.push(a.lights.fsShaderExtension),d.calculateID=!1,e.calculateID=!1,d.getShaderInputs=function(a,b){var c=a.program,d=a.renderer,e=a.uniforms,f=a.attributes;f.vertexPositionAttribute=d.getAttribute(c,"aVertexPosition"),f.TexturePositionAttribute=d.getAttribute(c,"aTexturePosition"),f.VertexNormalAttribute=d.getAttribute(c,"aVertexNormal"),e.pMatrixUniform=d.getUniform(c,"uPMatrix"),e.cMatrixUniform=d.getUniform(c,"uCMatrix"),e.mvMatrixUniform=d.getUniform(c,"uMVMatrix"),e.samplerUniform=d.getUniform(c,"uSampler"),e.NMatrixUniform=d.getUniform(c,"uNMatrix")},a.shaders=a.shaders||{},a.shaders.baseShader=c}(EWGL),function(a){var b=a.shaderExtension,c=new a.shaderProgram({renderer:a.renderer}),d=new b({type:b.types.vertex});d.addAttribute("aVertexPosition","vec3"),d.addAttribute("aVertexNormal","vec3"),d.addAttribute("aVertexColor","vec4"),d.addUniform("uMVMatrix","mat4"),d.addUniform("uPMatrix","mat4"),d.addUniform("uCMatrix","mat4"),d.addUniform("uNMatrix","mat3"),d.addVarying("vColor","vec4"),d.appendProgram("gl_Position = uPMatrix * (uCMatrix * uMVMatrix) * vec4(aVertexPosition, 1.0);"),d.appendProgram("vColor = aVertexColor;"),c.vsMain=d;var e=new b({type:b.types.fragment});e.addPreprocessor("#ifdef GL_ES\n  precision highp float; \n#endif \n"),e.addVarying("vColor","vec4"),e.appendProgram("gl_FragColor = vColor;"),c.fsMain=e,c.extensions.push(a.lights.vsShaderExtension),c.extensions.push(a.lights.fsShaderExtension),d.calculateID=!1,e.calculateID=!1,d.getShaderInputs=function(a,b){var c=a.program,d=a.renderer,e=a.uniforms,f=a.attributes;f.vertexPositionAttribute=d.getAttribute(c,"aVertexPosition"),f.vertexColorAttribute=d.getAttribute(c,"aVertexColor"),f.VertexNormalAttribute=d.getAttribute(c,"aVertexNormal"),e.pMatrixUniform=d.getUniform(c,"uPMatrix"),e.cMatrixUniform=d.getUniform(c,"uCMatrix"),e.mvMatrixUniform=d.getUniform(c,"uMVMatrix"),e.NMatrixUniform=d.getUniform(c,"uNMatrix")},a.shaders=a.shaders||{},a.shaders.colorShader=c}(EWGL),function(a){var b=a.shaderExtension,c=new a.shaderProgram({renderer:a.renderer}),d=new b({type:b.types.vertex});d.addAttribute("aVertexPosition","vec3"),d.addUniform("uPMatrix","mat4"),d.addUniform("uCMatrix","mat4"),d.appendProgram("gl_Position = uPMatrix * uCMatrix * vec4(aVertexPosition, 1.0);"),c.vsMain=d;var e=new b({type:b.types.fragment});e.addPreprocessor("#ifdef GL_ES\n  precision highp float; \n#endif \n"),e.appendProgram("gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"),c.fsMain=e,d.calculateID=!1,e.calculateID=!1,d.getShaderInputs=function(a,b){var c=a.program,d=a.renderer,e=a.uniforms,f=a.attributes;f.vertexPositionAttribute=d.getAttribute(c,"aVertexPosition"),e.pMatrixUniform=d.getUniform(c,"uPMatrix"),e.cMatrixUniform=d.getUniform(c,"uCMatrix")},a.shaders=a.shaders||{},a.shaders.whiteColorShader=c}(EWGL),function(a){var b,c={materials:[],baseMaterial:b};c.registerMaterial=function(a){c.materials.length===0&&(c.baseMaterial=a),c.materials.indexOf(a)?c.materials.push(a):console.log("material was already registered")},c.render=function(b){d(b);var e,f=c.materials.length;a.renderer.clear();for(e=0;e<f;e++)b.counter===c.materials[e].lastUpdate&&c.materials[e].render(b)};var d=function(b){b.frustrumCulled=0;var c=a.lights,d,e;if(c){d=c.lights,c.usedLights={};for(var f=0;f<d.length;f++)e=d[f],e.lastUpdate===b.counter&&(c.usedLights[e.type]=c.usedLights[e.type]||[],c.usedLights[e.type].push(e))}};a.materialList=c}(EWGL),function(a){var b,c,d=a.materialList,e=a.lights,f=function(c){c||(c={}),this.meshes={},this.geometries=[],this.zOrdered=!1,this.shaderProgram=c.shaderProgram||b,this.lastUpdate=-1,Object.defineProperties(this,{renderer:{get:function(){return a.renderer}}})},g=f.prototype;g.update=function(){},g.render=function(){},g.calculateNormals=function(a){var b=a.vertexbuffers,c=b.position.getData(),d=b.indices.getData(),e=new Float32Array(c.length),f,g=d.length,h,i,j,k=vec3.create(),l=vec3.create(),m=vec3.create(),n=vec3.create(),o=vec3.create(),p=vec3.create(),q=vec3.create();for(f=0;f<g;f+=3)h=d[f]*3,i=d[f+1]*3,j=d[f+2]*3,vec3.set([c[h],c[h+1],c[h+2]],k),vec3.set([c[i],c[i+1],c[i+2]],l),vec3.set([c[j],c[j+1],c[j+2]],m),vec3.subtract(m,l,n),vec3.subtract(k,l,o),vec3.cross(n,o,p),vec3.normalize(p),e[h]+=p[0],e[i]+=p[0],e[j]+=p[0],e[h+1]+=p[1],e[i+1]+=p[1],e[j+1]+=p[1],e[h+2]+=p[2],e[i+2]+=p[2],e[j+2]+=p[2];for(f=0,g=e.length;f<g;f+=3)vec3.set([e[f],e[f+1],e[f+2]],q),vec3.normalize(q),e[f]=q[0],e[f+1]=q[1],e[f+2]=q[2];a.addNewVertexbuffer({type:"normal",data:e})},g.isInFrustrum=function(b,c,d){return c.flags.boundingSphereChanged&&(c.boundingSphere||(c.boundingSphere=new a.boundingSphere),c.boundingSphere.getBoundingFromPoints(c.vertexbuffers.position.getData()),c.flags.boundingSphereChanged=!1),d.frustrum.isInFrustrum(b.worldTranslation,b.worldScale,c.boundingSphere)},a.material=f}(EWGL),function(a){var b,c,d=a.materialList,e=a.lights,f=a.shaderExtension,g=new a.material({shaderProgram:a.shaders.baseShader});g.render=function(a){var b,c=g.renderer,d=g.geometries.length,f=c.gl,i=this.shaderProgram,j,k;i.use(),f.uniformMatrix4fv(i.uniforms.pMatrixUniform,!1,g.renderer.camera.perspective),f.uniformMatrix4fv(i.uniforms.cMatrixUniform,!1,g.renderer.camera.inverseMatrix),e.vsShaderExtension.setShaderPieces(i,e.vsShaderExtension.calculateID());for(b=0;b<d;b++){j=g.geometries[b];if(j.lastUpdate===a.counter){k=j.mesh,f.uniformMatrix4fv(i.uniforms.mvMatrixUniform,!1,j.matrix);var l=mat4.multiply(g.renderer.camera.inverseMatrix,j.matrix,mat4.create()),m=mat4.toMat3(l,mat3.create());m=mat3.transpose(m),f.uniformMatrix3fv(i.uniforms.NMatrixUniform,!1,m),k.vertexbuffers.position.flags.dataChanged&&c.AdjustGLBuffer(k.vertexbuffers.position),k.vertexbuffers.normal||this.calculateNormals(j),k.vertexbuffers.normal.flags.dataChanged&&c.AdjustGLBuffer(k.vertexbuffers.normal),k.vertexbuffers.color.flags.dataChanged&&c.AdjustGLBuffer(k.vertexbuffers.color),k.vertexbuffers.texture.flags.dataChanged&&c.AdjustGLBuffer(k.vertexbuffers.texture),k.vertexbuffers.indices.flags.dataChanged&&c.AdjustGLELMENTBuffer(k.vertexbuffers.indices),j.materialOptions.texture||(j.materialOptions.texture=h()),j.materialOptions.texture.texture||(j.materialOptions.texture.texture=f.createTexture()),j.materialOptions.texture.flags.imageLoaded&&(f.bindTexture(f.TEXTURE_2D,j.materialOptions.texture.texture),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,j.materialOptions.texture.image),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.bindTexture(f.TEXTURE_2D,null),j.materialOptions.texture.flags.imageLoaded=!1),f.bindBuffer(f.ARRAY_BUFFER,k.vertexbuffers.position.glObject),f.vertexAttribPointer(i.attributes.vertexPositionAttribute,3,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,k.vertexbuffers.normal.glObject),f.vertexAttribPointer(i.attributes.VertexNormalAttribute,3,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,k.vertexbuffers.color.glObject),f.vertexAttribPointer(i.attributes.vertexColorAttribute,4,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,k.vertexbuffers.texture.glObject),f.vertexAttribPointer(i.attributes.TexturePositionAttribute,2,f.FLOAT,!1,0,0),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,j.materialOptions.texture.texture),f.uniform1i(i.uniforms.samplerUniform,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,k.vertexbuffers.indices.glObject),f.drawElements(f.TRIANGLES,k.vertexbuffers.indices.size,f.UNSIGNED_SHORT,0)}}};var h=function(){return c||(c=new EWGL.texture({url:"http://media.tojicode.com/q3bsp/demo_baseq3/webgl/no-shader.png"})),c};d.registerMaterial(g),a.baseMaterial=g}(EWGL),function(a){var b,c,d=a.materialList,e=a.lights,f=mat4.create(),g=mat3.create(),h=new a.material({shaderProgram:a.shaders.colorShader});h.render=function(a){var b,c=h.renderer,d=h.geometries.length,i,k=c.gl,l=this.shaderProgram,m,n,o,p,q,r,s=h.renderer.camera;l.use(),k.uniformMatrix4fv(l.uniforms.pMatrixUniform,!1,s.perspective),k.uniformMatrix4fv(l.uniforms.cMatrixUniform,!1,s.inverseMatrix),e.vsShaderExtension.setShaderPieces(l,e.vsShaderExtension.calculateID());for(b=0;b<d;b++){i=h.geometries[b].length;if(i>0){n=h.geometries[b][0].mesh,n.vertexbuffers.position.flags.dataChanged&&c.AdjustGLBuffer(n.vertexbuffers.position),n.vertexbuffers.normal||this.calculateNormals(n),n.vertexbuffers.normal.flags.dataChanged&&c.AdjustGLBuffer(n.vertexbuffers.normal),n.vertexbuffers.color.flags.dataChanged&&c.AdjustGLBuffer(n.vertexbuffers.color),n.vertexbuffers.indices.flags.dataChanged&&c.AdjustGLELMENTBuffer(n.vertexbuffers.indices),k.bindBuffer(k.ARRAY_BUFFER,n.vertexbuffers.position.glObject),k.vertexAttribPointer(l.attributes.vertexPositionAttribute,3,k.FLOAT,!1,0,0),k.bindBuffer(k.ARRAY_BUFFER,n.vertexbuffers.normal.glObject),k.vertexAttribPointer(l.attributes.VertexNormalAttribute,3,k.FLOAT,!1,0,0),k.bindBuffer(k.ARRAY_BUFFER,n.vertexbuffers.color.glObject),k.vertexAttribPointer(l.attributes.vertexColorAttribute,4,k.FLOAT,!1,0,0),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,n.vertexbuffers.indices.glObject),o=h.geometries[b],p=n.vertexbuffers.indices.size,s=h.renderer.camera,r=s.matrix;for(j=0;j<i;j++){m=o[j];if(m.lastUpdate===this.lastUpdate&&this.isInFrustrum(m,n,s)){q=m.matrix,k.uniformMatrix4fv(l.uniforms.mvMatrixUniform,!1,q);var t=mat4.multiply(r,q,f),u=mat4.toMat3(mat4.inverse(t),g);u=mat3.transpose(u),k.uniformMatrix3fv(l.uniforms.NMatrixUniform,!1,u),k.drawElements(k.TRIANGLES,p,k.UNSIGNED_SHORT,0)}else a.frustrumCulled?a.frustrumCulled++:a.frustrumCulled=1}}}},d.registerMaterial(h),a.colorMaterial=h}(EWGL),function(a){materialList=a.materialList;var b={geometries:[],zOrdered:!1,lastUpdate:-1};Object.defineProperties(b,{renderer:{get:function(){return a.renderer}}}),b.update=function(){},b.render=function(a){var c,d=b.geometries.length,f=b.renderer.gl,g=b.renderer,h=g.camera,i,j,k;b.shaderProgram||e(),i=b.shaderProgram,g.useProgram(i),f.uniformMatrix4fv(i.pMatrixUniform,!1,h.perspective),f.uniformMatrix4fv(i.cMatrixUniform,!1,h.inverseMatrix);for(c=0;c<d;c++)j=b.geometries[c],j.lastUpdate===a.counter&&(k=j.mesh,f.uniformMatrix4fv(i.mvMatrixUniform,!1,j.matrix),k.vertexbuffers.position.flags.dataChanged&&g.AdjustGLBuffer(k.vertexbuffers.position),k.vertexbuffers.color.flags.dataChanged&&g.AdjustGLBuffer(k.vertexbuffers.color),k.vertexbuffers.indices.flags.dataChanged&&g.AdjustGLELMENTBuffer(k.vertexbuffers.indices),f.bindBuffer(f.ARRAY_BUFFER,k.vertexbuffers.position.glObject),f.vertexAttribPointer(i.vertexPositionAttribute,3,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,k.vertexbuffers.color.glObject),f.vertexAttribPointer(i.vertexColorAttribute,4,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,k.vertexbuffers.indices.glObject),f.drawElements(f.LINES,k.vertexbuffers.indices.size,f.UNSIGNED_SHORT,0))};var c="attribute vec3 aVertexPosition;attribute vec4 aVertexColor;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform mat4 uCMatrix;varying vec4 vColor;void main(void) {  gl_Position = uPMatrix * (uCMatrix * uMVMatrix) * vec4(aVertexPosition, 1.0);  vColor = aVertexColor;}",d="#ifdef GL_ES\n  precision highp float; \n#endif \nvarying vec4 vColor;void main(void) { \ngl_FragColor = vColor; \n}\n",e=function(){var a=b.renderer,e=a.createShaderProgram(c,d);e.vertexPositionAttribute=a.getAttribute(e,"aVertexPosition"),e.vertexColorAttribute=a.getAttribute(e,"aVertexColor"),e.TexturePosition=a.getAttribute(e,"aTexturePosition"),e.pMatrixUniform=a.getUniform(e,"uPMatrix"),e.cMatrixUniform=a.getUniform(e,"uCMatrix"),e.mvMatrixUniform=a.getUniform(e,"uMVMatrix"),e.samplerUniform=a.getUniform(e,"uSampler"),b.shaderProgram=e};materialList.registerMaterial(b),a.linesMaterial=b}(EWGL),function(a){var b,c;materialList=a.materialList;var d={geometries:[],zOrdered:!1,shaderProgram:b,lastUpdate:-1};Object.defineProperties(d,{renderer:{get:function(){return a.renderer}}}),d.update=function(){},d.render=function(a){var b,c=d.renderer,f=d.geometries.length,g=d.renderer.gl,i,j,k;d.shaderProgram||h(),i=d.shaderProgram,c.useProgram(i),g.uniformMatrix4fv(i.pMatrixUniform,!1,d.renderer.camera.perspective),g.uniformMatrix4fv(i.cMatrixUniform,!1,mat4.inverse(quat4.toMat4(d.renderer.camera.worldRotation)));for(b=0;b<f;b++)j=d.geometries[b],j.lastUpdate===a.counter&&(k=j.mesh,g.uniformMatrix4fv(i.mvMatrixUniform,!1,j.matrix),k.vertexbuffers.position.flags.dataChanged&&c.AdjustGLBuffer(k.vertexbuffers.position),k.vertexbuffers.color.flags.dataChanged&&c.AdjustGLBuffer(k.vertexbuffers.color),k.vertexbuffers.texture.flags.dataChanged&&c.AdjustGLBuffer(k.vertexbuffers.texture),k.vertexbuffers.indices.flags.dataChanged&&c.AdjustGLELMENTBuffer(k.vertexbuffers.indices),j.materialOptions.texture||(j.materialOptions.texture=e()),j.materialOptions.texture.texture||(j.materialOptions.texture.texture=g.createTexture()),j.materialOptions.texture.flags.imageLoaded&&(g.bindTexture(g.TEXTURE_2D,j.materialOptions.texture.texture),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,j.materialOptions.texture.image),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.bindTexture(g.TEXTURE_2D,null),j.materialOptions.texture.flags.imageLoaded=!1),g.bindBuffer(g.ARRAY_BUFFER,k.vertexbuffers.position.glObject),g.vertexAttribPointer(i.vertexPositionAttribute,3,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,k.vertexbuffers.color.glObject),g.vertexAttribPointer(i.vertexColorAttribute,4,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,k.vertexbuffers.texture.glObject),g.vertexAttribPointer(i.TexturePosition,2,g.FLOAT,!1,0,0),g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,j.materialOptions.texture.texture),g.uniform1i(i.samplerUniform,0),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,k.vertexbuffers.indices.glObject),g.drawElements(g.TRIANGLES,k.vertexbuffers.indices.size,g.UNSIGNED_SHORT,0))};var e=function(){return c||(c=new EWGL.texture({url:"http://media.tojicode.com/q3bsp/demo_baseq3/webgl/no-shader.png"})),c},f="attribute vec3 aVertexPosition;attribute vec2 aTexturePosition;attribute vec4 aVertexColor;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform mat4 uCMatrix;varying vec4 vColor;varying vec2 vTexture;void main(void) {  gl_Position = uPMatrix * (uCMatrix * uMVMatrix) * vec4(aVertexPosition, 1.0);  vColor = aVertexColor;  vTexture = aTexturePosition;}",g="#ifdef GL_ES\n  precision highp float; \n#endif \nvarying vec4 vColor;varying vec2 vTexture;uniform sampler2D uSampler;void main(void) { \ngl_FragColor = texture2D(uSampler, vec2(vTexture.s, vTexture.t)); \n}\n",h=function(){var a=+(new Date),b=d.renderer,c=b.createShaderProgram(f,g);c.vertexPositionAttribute=b.getAttribute(c,"aVertexPosition"),c.vertexColorAttribute=b.getAttribute(c,"aVertexColor"),c.TexturePosition=b.getAttribute(c,"aTexturePosition"),c.pMatrixUniform=b.getUniform(c,"uPMatrix"),c.cMatrixUniform=b.getUniform(c,"uCMatrix"),c.mvMatrixUniform=b.getUniform(c,"uMVMatrix"),c.samplerUniform=b.getUniform(c,"uSampler"),d.shaderProgram=c};materialList.registerMaterial(d),a.skyboxMaterial=d}(EWGL),function(a){var b,c=a.node,d=a.geometry,e=a.vertexbuffer,f=function(a){d.call(this,a),this.mesh.addVertexbuffer(new e({type:"position",data:[0,1,0,-1,-1,0,1,-1,0]})),this.mesh.addVertexbuffer(new e({type:"color",data:[1,1,1,1,1,1,1,1,1,1,1,1]})),this.mesh.addVertexbuffer(new e({type:"indices",data:[0,1,2]}))};f.prototype=new d,f.prototype.material=b,c.prototype.attachNewTriangle=function(a){var b=new f(a);return this.addChildren(b),b},a.triangle=f}(EWGL),function(a){var b,c=a.node,d=a.geometry,e=a.vertexbuffer,f=function(a){d.call(this,a),this.mesh.addNewVertexbuffer({type:"position",data:[.5,.5,0,-0.5,-0.5,0,.5,-0.5,0,-0.5,.5,0]}),this.mesh.addNewVertexbuffer({type:"color",data:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}),this.mesh.addNewVertexbuffer({type:"indices",data:[0,2,1,0,1,3]}),this.mesh.addNewVertexbuffer({type:"texture",data:[0,0,1,1,0,1,1,0]})};f.prototype=new d,f.prototype.material=b,c.prototype.attachNewQuad=function(a){var b=new f(a);return this.addChildren(b),b},a.quad=f}(EWGL),function(a){var b,c=a.node,d=a.geometry,e=a.vertexbuffer,f=function(a){d.call(this,a),this.mesh.addNewVertexbuffer({type:"position",data:[1,1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1,1]}),this.mesh.addNewVertexbuffer({type:"color",data:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}),this.mesh.addNewVertexbuffer({type:"indices",data:[0,1,2,0,3,1,4,5,6,4,7,5,8,9,10,8,11,9,12,14,13,12,13,15,16,17,18,16,19,17,20,21,22,20,23,21]}),this.mesh.addNewVertexbuffer({type:"texture",data:[0,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0]})};f.prototype=new d,f.prototype.material=b,c.prototype.attachNewCube=function(a){var b=new f(a);return this.addChildren(b),b},a.cube=f}(EWGL),function(a){var b,c=a.node,d=a.geometry,e=a.vertexbuffer,f=function(a){d.call(this,a),a=a||{};var b=a.latitudeBands||30,c=a.longitudeBands||30,e=a.radius||1,f=[],g=[],h=[],i=[];for(var j=0;j<=b;j++){var k=j*Math.PI/b,l=Math.sin(k),m=Math.cos(k);for(var n=0;n<=c;n++){var o=n*2*Math.PI/c,p=Math.sin(o),q=Math.cos(o),r=q*l,s=m,t=p*l,u=1-n/c,v=1-j/b;g.push(r),g.push(s),g.push(t),h.push(u),h.push(v),f.push(e*r),f.push(e*s),f.push(e*t),i.push(1),i.push(1),i.push(1),i.push(1)}}var w=[];for(var j=0;j<b;j++)for(var n=0;n<c;n++){var x=j*(c+1)+n,y=x+c+1;w.push(x),w.push(x+1),w.push(y),w.push(y),w.push(x+1),w.push(y+1)}this.mesh.addNewVertexbuffer({type:"position",data:f}),this.mesh.addNewVertexbuffer({type:"color",data:i}),this.mesh.addNewVertexbuffer({type:"indices",data:w}),this.mesh.addNewVertexbuffer({type:"texture",data:h})};f.prototype=new d,f.prototype.material=b,c.prototype.attachNewSphere=function(a){var b=new f(a);return this.addChildren(b),b},a.sphere=f}(EWGL),function(a){var b=a.node,c,d=function(c){return b.call(this,c),this.attachNewQuad({material:a.skyboxMaterial,translation:[-0.5,0,0],rotation:[.7071,0,-0.7071,0],materialOptions:{texture:c.left}}),this.attachNewQuad({material:a.skyboxMaterial,translation:[.5,0,0],rotation:[.7071,0,.7071,0],materialOptions:{texture:c.right}}),this.attachNewQuad({material:a.skyboxMaterial,translation:[0,0,-0.5],rotation:[1,0,0,0],materialOptions:{texture:c.front}}),this.attachNewQuad({material:a.skyboxMaterial,translation:[0,0,.5],rotation:[0,0,1,0],materialOptions:{texture:c.back}}),this.attachNewQuad({material:a.skyboxMaterial,translation:[0,.5,0],rotation:[0,.7071,.7071,0],materialOptions:{texture:c.top}}),this.attachNewQuad({material:a.skyboxMaterial,translation:[0,-0.5,0],rotation:[-0.7071,0,0,.7071],materialOptions:{texture:c.bottom}}),this};d.prototype=new b,b.prototype.attachNewSkybox=function(a){var b=new d(a);return this.addChildren(b),b},a.skybox=d}(EWGL),function(a){var b,c=a.node,d=a.geometry,e=a.vertexbuffer,f=function(b){d.call(this,b);var c=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1];this.mesh.addNewVertexbuffer({type:"position",data:c}),this.mesh.addNewVertexbuffer({type:"indices",data:[0,1,0,2,0,4,1,3,1,5,2,3,2,6,3,7,4,5,4,6,5,7,6,7]}),this.flags.NoBoundingBox=!0,this.material=a.debugBoundingBoxesMaterial};f.prototype=new d,f.prototype.material=a.debugBoundingBoxesMaterial,f.prototype.update=function(a){var b=this.parent.boundingBox,c=[b.minX,b.minY,b.minZ,b.minX,b.minY,b.plusZ,b.minX,b.plusY,b.minZ,b.minX,b.plusY,b.plusZ,b.plusX,b.minY,b.minZ,b.plusX,b.minY,b.plusZ,b.plusX,b.plusY,b.minZ,b.plusX,b.plusY,b.plusZ];this.mesh.vertexbuffers.position.setData(c),this.lastUpdate=a.counter,this.material.lastUpdate=a.counter},c.prototype.attachNewBoundingBoxOutline=function(a){var b=new f(a);return this.addChildren(b),b},a.boundingBoxOutline=f}(EWGL),function(a){var b,c={loaders:[],extensions:{},specialCases:[],defaultLoader:b,onLoadedCompleted:function(){console.log("Everything is loaded")}};Object.defineProperties(c,{_counter:{value:0,configurable:!0,writable:!0},counter:{get:function(){return c._counter},set:function(a){c._counter=a,c._counter===0&&d()}}}),c.addLoader=function(a){var d,e;c.loaders.push(a.loader);if(a.extensions){e=a.extensions.length;if(e!==b)for(d=0;d<e;d++)c.extensions[a.extensions[d].toUpperCase()]=a.loader;else c.extensions[a.extensions.toUpperCase()]=a.loader}if(a.specialCases){e=a.specialCases.length;if(e!==b)for(d=0;d<e;d++)c.specialCases.push({evaluate:a.specialCases[d],loader:a.loader});else c.specialCases.push({evaluate:a.specialCases[d],loader:a.loader})}},c.load=function(a){var b,d,e;d=c.specialCases.length;for(b=0;b<d;b++)if(c.specialCases[b].evaluate(a))return c.load(a);return b=a.url.lastIndexOf("."),d=a.url.substring(b+1).toUpperCase(),c.extensions[d]?c.extensions[d](a):c.defaultLoader(a)},c.onComplete=function(a){console.log("test")},c.onError=function(a){throw"Something Not loaded correctly."};var d=function(){c.onLoadedCompleted()};a.loader=c}(EWGL),function(a){var b=a.loader,c=[],d=function(a){b.counter+=1,a=a||{};var c=a.image||new Image,d={image:c};return c.onload=e(a.onComplete,d),c.onerror=f(a.onError,d),a.url.indexOf("http")!==-1&&(c.crossOrigin=""),c.src=a.url,c},e=function(a,c){return function(){a?a(c):b.onComplete(c),b.counter-=1}},f=function(a,c){return function(){a?a(c):b.onError(c),b.counter-=1}};b.loadImage=function(a){return d(a)},b.addLoader({loader:d,extensions:["JPG","PNG","GIF"]})}(EWGL),function(a){var b=a.loader,c=a.texture,d=new Image,e=function(a){var d=new c,e={};return e.url=a.url,e.onComplete=f(a.onComplete,{texture:d}),e.onError=g(a.onError,{texture:d}),d.image=b.loadImage(e),d},f=function(a,b){return function(){a&&a(b),b.texture.flags.imageLoaded=!0}},g=function(a,b){return function(){a&&a(b)}};b.loadTexture=function(a){return e(a)},b.addLoader({loader:e})}(EWGL),function(a){var b,c=function(a){this._node=a.node||b};Object.defineProperties(c.prototype,{node:{get:function(){return this._node},set:function(a){this._node=a,this.changedNode()}}}),c.prototype._node=b,c.prototype.update=function(){},c.prototype.changedNode=function(){},a.controller=c}(EWGL),function(a){var b,c=a.controller,d=function(a){this._node=a.node,this.rpm=a.rpm||0,this.axis=a.axis||vec3.create(),this.normalizedAxis=vec3.create(),this.startRotation=quat4.create(),this.rotationToSet=quat4.create(),a.notStarting?this.stop():this.start()};d.prototype=new c({}),d.prototype.rpm=0,d.prototype.axis=[0,0,0],d.prototype.startTime=0,d.prototype.enabled=!1,d.prototype.startRotation=quat4.create(),d.prototype.start=function(){this.startTime=+(new Date),this.enabled=!0},d.prototype.stop=function(){this.startTime=+(new Date),this.enabled=!1},d.prototype.update=function(a){var b=a.now-this.startTime,c=b*this.rpm/6e4,d=vec3.normalize(this.axis,this.normalizedAxis);this.rotationToSet[0]=d[0]*Math.sin(c/2),this.rotationToSet[1]=d[1]*Math.sin(c/2),this.rotationToSet[2]=d[2]*Math.sin(c/2),this.rotationToSet[3]=Math.cos(c/2),this.node.rotation=this.rotationToSet},d.prototype.changedNode=function(){this.node&&(this.startRotation=quat4.create(this.node.rotation))},a.positionController=d}(EWGL),function(a){var b,c=a.controller,d=function(a){this._node=a.node,this.path=a.path||[],this.totaltime=e(this.path),a.notStarting?this.stop():this.start()};d.prototype=new c({}),d.prototype.rpm=0,d.prototype.path=[],d.prototype.totaltime=0,d.prototype.enabled=!1;var e=function(a){var b,c=a.length,d=0;for(b=0;b<c;b++)d+=a[b].time;return d};d.prototype.start=function(){this.startTime=+(new Date),this.enabled=!0},d.prototype.stop=function(){this.startTime=+(new Date),this.enabled=!1},d.prototype.update=function(){var a=+(new Date)-this.startTime,b=a%this.totaltime,c=this.path,d=0,e=c.length,f=0,g=vec3.create();for(d=0;d<e;d++)if(f+c[d].time<b)f+=c[d].time,vec3.add(g,c[d].translation);else if(f<b){var h=b-f,i=vec3.scale(c[d].translation,h/c[d].time,vec3.create());vec3.add(g,i),f+=c[d].time}this.node.translation=g},a.pathController=d}(EWGL),function(a){var b,c=a.controller,d=a.inputManager;d.addKeyHandler({name:"distanceAngleController.left",keyName:d.keyboard.keys.LEFT_ARROW}),d.addKeyHandler({name:"distanceAngleController.right",keyName:d.keyboard.keys.RIGHT_ARROW}),d.addKeyHandler({name:"distanceAngleController.down",keyName:d.keyboard.keys.DOWN_ARROW}),d.addKeyHandler({name:"distanceAngleController.up",keyName:d.keyboard.keys.UP_ARROW}),d.addMouseDragHandler({name:"distanceAngleController.drag",keyName:d.mouse.mouseButtons.LEFT}),d.addMouseWheelHandler({name:"distanceAngleController.wheel"});var e=function(a){this.distance=0,this.height=0,this.angle=0,this.targetPosition=a.targetPosition||vec3.create(0,0,0),this.initialVecUp=[0,1,0]};e.prototype=new c({}),e.prototype.distance=0,e.prototype.angle=quat4.create(),e.prototype.changedNode=function(){var a=this.node,b=this.targetPosition,c=this;if(this.node){var e=vec3.subtract(this.node.worldTranslation,this.targetPosition,[]);this.distance=Math.sqrt(e[0]*e[0]+e[2]*e[2]),this.height=e[1],this.angle=Math.atan2(e[2],e[0]),b=this.targetPosition,d.addMapping("distanceAngleController.left",function(){c.angle+=.05,f(c,a,b)}),d.addMapping("distanceAngleController.right",function(){c.angle-=.05,f(c,a,b)}),d.addMapping("distanceAngleController.up",function(){c.distance-=.3,f(c,a,b)}),d.addMapping("distanceAngleController.down",function(){c.distance+=.3,f(c,a,b)}),d.addMapping("distanceAngleController.drag",function(d){var e=d.mouse;e.position[0]>e.prevPosition[0]?c.angle+=.05:e.position[0]<e.prevPosition[0]&&(c.angle-=.05),f(c,a,b)}),d.addMapping("distanceAngleController.wheel",function(d){c.distance-=1*d,f(c,a,b)}),a.lookAt(b)}};var f=function(a,b,c){b.translation=vec3.add([Math.cos(a.angle)*a.distance,a.height,Math.sin(a.angle)*a.distance],c),b.lookAt(c)};a.distanceAngleController=e}(EWGL),function(a){var b={},c=function(b){var c,e,f;e=a.renderer,this.renderer=a.renderer,this.materialList=a.materialList,this.input=a.inputManager,this.lights=a.lights,f=new a.node({name:"rootNode"}),this.rootNode=f,c=new a.cameraNode({name:"mainCamera",parent:this.rootNode}),e.camera=c,this.mainLight=new a.ambientLight({name:"mainLight",color:vec3.create([.5,.5,.5]),parent:this.rootNode}),this.stats=new a.stats,this.assetManager=a.loader,this.assetManager.onLoadedCompleted=function(a){return function(){a.startRendering()}}(this);if(b&&b.canvas){var g=document.getElementById(b.canvas.id);g.width=b.canvas.width,g.height=b.canvas.height,this.renderer.canvas=g}else this.renderer.canvas=d()};Object.defineProperties(c.prototype,{camera:{get:function(){return this.renderer.camera},set:function(a){this.renderer.camera=a}}}),c.prototype.startRendering=function(){var a=this;timestart=+(new Date);var c=function(){requestAnimationFrame(c),a.stats.update(b),a.update(b),a.input.update(b),a.rootNode.update(b),a.materialList.render(b)};c()},c.prototype.renderOnce=function(){this.stats.update(b),this.update(b),this.input.update(b),this.rootNode.update(b),this.materialList.render(b)},c.prototype.update=function(a){};var d;d=function(){var a;return a=document.createElement("canvas"),a.width=window.innerWidth,a.height=window.innerHeight,document.body.appendChild(a),a},a.app=c}(EWGL),function(a){var b,c,d,e,f,g,h=function(){e=+(new Date),this.timeCapsule=[];for(d=0;d<100;d++)this.timeCapsule.push(e);this.counter=0};h.prototype.update=function(a){f=this.timeCapsule,c=Date.now(),e=f[99],g=f[0],f.shift(),f.push(c),this.counter++,a.now=c,a.timeElapsed=c-e,a.counter=this.counter,a.AvgTime=(c-g)/99,a.fps=parseInt(1e3/a.AvgTime,10)},a.stats=h}(EWGL)